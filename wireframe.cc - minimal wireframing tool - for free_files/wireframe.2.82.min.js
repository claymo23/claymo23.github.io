function updateCanvasInput(){var e=parseInt($canvaswrap.width(),10),a=parseInt($canvaswrap.height(),10);$(".canvassize").html("<b>canvas</b>: "+e+"/"+a+"px"),$("#canvas_w_val").val(e),$("#canvas_h_val").val(a)}function setgridsize(){gridsize=$canvaswrap.attr("snappy"),gridsize>0?($(".grid-size-val").text(gridsize),$("#snap-to-grid").attr("checked",!0),updategrid(gridsize),$("#grid-slider").slider("value",gridsize)):"col"==gridsize?($("#snap-to-grid").attr("checked",!0),$("select#grid-type").val("col"),gridsize=0,updategrid("col")):(updategrid(20),$("#grid-slider").slider("value",20))}function lock(){if(multipaged)var e=$("#canvas .page:visible .selected");else var e=$("#canvas .selected");e.length&&!$("#canvas .selected.locked").length?(e.addClass("locked , icon-").draggable("destroy").resizable("destroy").click(function(){0==$("#canvas .brandnew").length&&($(this).addClass("selected"),$("#lock").addClass("pressed"))}),$("#lock").addClass("pressed")):$("#canvas .selected.locked").length&&($("#canvas .selected.locked").removeClass("locked icon-").unbind("click"),$("#lock").removeClass("pressed"),makeDrag(e))}function showSaveButton(){$("#slogan").fadeOut("fast",function(){$(".controls").fadeIn(),$("#links").addClass("linksmin")})}function InstantShowSaveButton(){$("#slogan").hide(),$("#links").addClass("linksmin"),$("#demo").hide(),$(".controls").show()}function divClicked(){$("#canvas").boxer("destroy"),$(this).parent().addClass("latest");var e=$(this).html().replace(/<br>/gi,"\n"),a=$("<textarea class='editingtext'/>");a.val($("<div />").html(e).text()).addClass("textareanow"),$(this).replaceWith(a),a.focus(),a.blur(editableTextBlurred),$(".latest .ok").show(),$("textarea").autosize(),$(".annotbox").addClass("textareainside"),$(".ok").click(editableTextBlurred)}function edittext(e){if(!previewMode){e.stopPropagation(),console.log($(this)),activepage.boxer("destroy");var a=$canvas.find(".selected .textme");saveState(a.closest(".wire")),a.parent().parent().parent().removeClass("selected").css("z-index",9999999);var t=a.html().replace(/<br>/gi,"\n"),s=$("<textarea class='editingtext' tabindex='-1' ></textarea>");s.val($("<div />").html(t).text()),a.replaceWith(s),s.focus(),s.bind("blur",textblur),s.autosize()}}function focustext(){$(".latest .editingtext").focus()}function textblur(){previewMode||useboxer();var e=$canvas.find(".editingtext");e.parent().parent().parent().css("z-index","auto");var a=e.val().replace(/\n/gi,"<br>"),t=$("<div>");""===a&&(a="..."),t.html(a).addClass("textme"),e.replaceWith(t);var s=t.css("height");t.closest(".wire").css({height:s,position:"absolute"}),t.closest(".wirejr").draggable("destroy")}function editableTextBlurred(){previewMode||useboxer(),$(".textareanow").parent().removeClass("latest");var e=$(".textareanow").val().replace(/\n/gi,"<br>"),a=$("<div>");""===e&&(e="..."),a.html(e),$(".textareanow").replaceWith(a),a.click(divClicked),$(".ok").hide(),previewMode&&(saveComment(),a.parent().parent().draggable({cancel:".annotbox , .closeannot",cursor:"move"}).resizable({handles:"all"}))}function useboxer(){activepage.boxer({cursor:"pointer",stop:function(e,a){if($(".brandnew").hasClass("selecting")){var t=".brandnew";if(multipaged)var s="#canvas .page:visible .wire";else var s=".wire";var i=$(t).collision(s);i.not(".groupmember").addClass("selected").draggable("enable"),$("#canvas .selected.locked").length&&0===$("#canvas .selected:not(.locked)").length&&$("#lock").addClass("pressed"),$("#canvas .selected.grouped").length&&0===$("#canvas .selected:not(.grouped)").length&&$("#group").addClass("pressed"),$("#canvas .brandnew").remove()}else{var n=(a.box.height(),a.box.width());if(a.box.width()>20||a.box.height()>20){$("#icons").show().siblings().hide(),aspect_ratio($("#canvas .blank")),$("#annotate").show(),$("#textinput").removeClass("lasticon");var o=a.box.position(),r=o.top,d=o.left,l=$("#canvas-wrap").position(),c=r+l.top-40,p=wirepanel.width(),h=d+n/2-p/2+l.left;0>=h&&(h=0),wirepanel.css({top:c,left:h}),wirepanel.show()}else a.box.remove()}}})}function prepareWire(){var e=$(".brandnew"),a=e.height();if(e.removeAttr("class").addClass("wirejr brandnew blank latestwire").empty().css({background:defbgcolor,width:clonewidth-2*defbw+1,height:cloneheight-2*defbw+1,"border-width":defbw+"px","border-color":defstrcolor,color:defstrcolor}),e.addClass("new").addClass(type).css("margin-top",0),"annotate"==type&&$(".brandnew.annotate").removeClass("wire").addClass("aa").append(annotationhtml).draggable({cancel:".annotbox , .closeannot",cursor:"move"}),("slider2"==type||"line_hor"==type)&&e.addClass("resizeX"),"slider"==type&&e.css("margin-top",a/2-3).removeClass("slider").addClass("slider2").append("<span>").find("span").css("background",defstrcolor),"line_hor"==type&&e.css("margin-top",a/2),"scrollh"==type&&e.css("margin-top",a/2-10),"paragraph"==type&&e.append(paragraph).find("span").css("background",defstrcolor),"textinput"==type&&e.removeClass("textinput").addClass("textinput2").append("<span>|</span>"),"combobox"==type&&e.removeClass("combobox").addClass("combobox2").append("<span>&#9660;</span>"),"scrollh"==type&&e.removeClass("scrollh").addClass("scrollh2").append("<span class='arrL'>&#9664;</span>").append("<span >&#9654;</span>"),"progressbar"==type&&e.removeClass("progressbar").addClass("progressbar2").append("<span></span>"),"list"==type&&e.append(list).find("span").css("background",defstrcolor),"headlinetxt"==type&&e.addClass("lastheadline textnew").append(texthtml),e.hasClass("headline")&&$(".brandnew.headline").html(headtxt).find(".headtext span").css("background",defstrcolor),e.hasClass("image")){e.svg();var t=e.width(),s=e.height(),i=e.svg("get");i.line(0,s,t,0,{"class":"line1",stroke:defstrcolor,strokeWidth:defbw}),i.line(0,0,t,s,{"class":"line2",stroke:defstrcolor,strokeWidth:defbw}),e.addClass("hasSVG")}}function insertWire(){if($("#canvas .brandnew").length){if("annotate"!==type){var e=$(".brandnew");e.wrap("<div class='wire'></div>");var a=e.closest(".wire"),t=e.width(),s=e.height(),i=e.position(),n=i.top,o=i.left;activepage.find(".wirejr").not(".aa").each(function(){var e=parseInt($(this).css("zIndex"),10);e>index_highest&&(index_highest=e)});var r="w"+(new Date).getTime();saveState("",[r]),a.css({top:n,left:o,width:t+2*defbw,height:s+2*defbw}).attr("id",r),e.css("cssText","top: 0 !important;left: 0 !important;height:"+s+"px;width:"+t+"px;border-width:"+defbw+"px;border-color:"+defstrcolor+";color:"+defstrcolor+";background:"+defbgcolor+";z-index:"+index_highest+";"),e.is(".aa")&&e.css("z-index","5000").removeClass("wirejr"),makeDrag(a)}else makeDrag($(".brandnew")),$(".brandnew").removeClass("wirejr").css("z-index",5e3);if("headlinetxt"==type&&($(".brandnew").parent().addClass("hastext selected"),$(".textme.thelatest").trigger("editThisText"),$(".textnew.lastheadline").removeClass("lastheadline")),"annotate"==type&&($(".editme").click(divClicked),$(".thelatest").click(),$(".closeannot").click(function(){var e=$(this).parent();e.remove()})),$(".brandnew").removeClass("blank brandnew"),wirePresent){var d=$(".wire").length;d>0&&(showSaveButton(),wirePresent=!1)}wirepanel.fadeOut("fast")}}function makeDrag(e){$("#canvas .wire").mousedown(function(e){1==e.altKey&&($(this).draggable("option","helper","clone").removeClass("selected").addClass("altdrag"),$("#canvas").droppable({drop:function(e,a){saveState();var t=$(a.helper).clone().removeClass("ui-draggable-dragging");multipaged?t.appendTo(".page:visible").addClass("selected").removeClass("altdrag").find(".ui-resizable-handle").remove():t.appendTo("#canvas").addClass("selected").removeClass("altdrag").find(".ui-resizable-handle").remove();var s=[];t.each(function(e){var a="w"+(new Date).getTime()+e;$(this).attr("id",a),s[e]=a}),historystate.shift(),saveState("",s),makeDrag(t),$(".wire").draggable("option","helper","none"),$("#canvas").droppable("destroy")}}))}),e.filter(".locked").click(function(){0==$("#canvas .brandnew").length&&0===$("#canvas .selected:not(.locked)").length&&($(this).addClass("selected"),$("#lock").addClass("pressed"))});var a;e.not(".groupmember , .wirejr , .locked").draggable({snap:".col ",start:function(e,s){var i=$(this);$canvaswrap.find(".brandnew").remove(),i.hasClass("selected")?saveState():saveState(i),t=parseInt($(this).css("borderLeftWidth"),10),$(".selected.locked").removeClass("selected"),s.helper.data("draggableXY.originalPosition",s.position||{top:0,left:0}),s.helper.data("draggableXY.newDrag",!0),!e.shiftKey&&$("#canvas .selected:not(.locked)").length<2&&$(".selected").removeClass("selected"),a=$("#canvas .selected:not(.locked)"),$(".dim").html("<b>W</b>: "+$(this).outerWidth()+"px, <b>H</b>: "+$(this).outerHeight()+"px"),wirepanel.hide(),a.children().removeClass("selected"),posTopArray=[],posLeftArray=[],$(this).hasClass("selected")&&a.each(function(e){thiscsstop=$(this).css("top"),"auto"==thiscsstop&&(thiscsstop=0),thiscssleft=$(this).css("left"),"auto"==thiscssleft&&(thiscssleft=0),posTopArray[e]=parseInt(thiscsstop,10),posLeftArray[e]=parseInt(thiscssleft,10)}),begintop=$(this).offset().top,beginleft=$(this).offset().left,0==gridsize&&"col"==$("select#grid-type").val()&&1==$("#snap-to-grid").attr("checked")?guides=multipaged?$.map($("#canvas .page:visible .wire, #canvas , #gridcol .col").not(this),computeGuidesForElement):$.map($("#canvas .wire, #canvas , #gridcol .col").not(this),computeGuidesForElement):0==gridsize&&(guides=multipaged?$.map($("#canvas .page:visible .wire, #canvas").not(this),computeGuidesForElement):$.map($("#canvas .wire, #canvas").not(this),computeGuidesForElement)),innerOffsetX=e.pageX-this.offsetLeft,innerOffsetY=e.pageY-this.offsetTop},drag:function(e,t){if(e.shiftKey){var s=t.helper.data("draggableXY.originalPosition"),i=Math.abs(s.left-t.position.left),n=Math.abs(s.top-t.position.top),o=t.helper.data("draggableXY.newDrag");t.helper.data("draggableXY.newDrag",!1);var r=o?Math.max(i,n)===i:t.helper.data("draggableXY.xMax");t.helper.data("draggableXY.xMax",r);{t.position}r&&$(this).draggable("option","axis","x"),r||$(this).draggable("option","axis","y")}if($(this).hasClass("selected")){var d=$(this).offset().left-beginleft,l=$(this).offset().top-begintop;a.each(function(e){$(this).css("top",posTopArray[e]+l),$(this).css("left",posLeftArray[e]+d)})}if(0==gridsize){var c,p,h,g,v,u=($("#canvas").offset(),MIN_DISTANCE+1),f=MIN_DISTANCE+1,m=$(this),b={top:e.pageY-innerOffsetY,left:e.pageX-innerOffsetX},w=m.outerWidth()-1,k=m.outerHeight()-1;$.each(guides,function(e,a){"h"==a.type&&((v=Math.abs(b.top-a.y))<f&&(f=v,p=a,g=0),(v=Math.abs(b.top-a.y+k))<f&&(f=v,p=a,g=k)),"v"==a.type&&((v=Math.abs(b.left-a.x))<u&&(u=v,c=a,h=0),(v=Math.abs(b.left-a.x+w))<u&&(u=v,c=a,h=w))}),(!e.shiftKey||e.shiftKey&&!r)&&(MIN_DISTANCE>=f?($("#guide-h").css("top",p.y).show(),t.position.top=p.y-g):($("#guide-h").hide(),t.position.top=b.top+1)),(!e.shiftKey||e.shiftKey&&r)&&(MIN_DISTANCE>=u?($("#guide-v").css("left",c.x).show(),t.position.left=c.x-h):($("#guide-v").hide(),t.position.left=b.left+1))}if(gridsize>0){var x=t.position.left,C=t.position.top,w=$(this).outerWidth()-1,k=$(this).outerHeight()-1,y=t.position.left+w,z=t.position.top+k;snappedleft=Math.round(x/gridsize)*gridsize,snappedright=Math.round(y/gridsize)*gridsize,snappedtop=Math.round(C/gridsize)*gridsize,snappedbottom=Math.round(z/gridsize)*gridsize;var _=Math.abs(snappedleft-t.position.left),I=Math.abs(snappedright-t.position.left-w),D=Math.abs(snappedtop-t.position.top),W=Math.abs(snappedbottom-t.position.top-k);t.position.left=I>_?snappedleft:snappedright-w,t.position.top=W>D?snappedtop:snappedbottom-k}},stop:function(){$("#guide-v, #guide-h").hide(),$(this).hasClass("altdrag")?$(".altdrag").removeClass("selected altdrag"):$(this).addClass("selected"),$(this).draggable("option","axis","none")}});var t=2;e.not(".groupmember , .wirejr , .locked").resizable({maxWidth:cwidth+1,autoHide:!1,start:function(){if(multipaged)var e=$("#canvas .page:visible .selected");else var e=$("#canvas .selected");$("#guide-v , #guide-h").hide(),handle=$(this).data("resizable").axis,saveState($(this)),t=parseInt(e.css("borderLeftWidth"),10),wirepanel.hide(),$(this).removeClass("selected"),0==gridsize&&"col"==$("select#grid-type").val()&&1==$("#snap-to-grid").attr("checked")?guides=multipaged?$.map($(" #canvas .page:visible .wire, #canvas , #gridcol .col").not(this),computeGuidesForElement):$.map($("#canvas .wire, #canvas , #gridcol .col").not(this),computeGuidesForElement):0==gridsize&&(guides=multipaged?$.map($("#canvas .page:visible .wire, #canvas").not(this),computeGuidesForElement):$.map($("#canvas .wire, #canvas").not(this),computeGuidesForElement))},resize:function(e,a){if(0==gridsize){var s,i,n,o,r,d=MIN_DISTANCE+1,l=MIN_DISTANCE+1,c={top:a.position.top,left:a.position.left},p=a.size.width-1,h=a.size.height-1;$.each(guides,function(e,a){"h"==a.type&&((r=c.top-a.y)<l&&(r=c.top-a.y)>-1*l&&"s"!==handle&&"se"!==handle&&"sw"!==handle&&(l=r,i=a,o=0),(r=c.top-a.y+h)<l&&(r=c.top-a.y+h)>-1*l&&"n"!==handle&&"ne"!==handle&&"nw"!==handle&&(l=r,i=a,o=h)),"v"==a.type&&((r=c.left-a.x)<d&&(r=c.left-a.x)>-1*d&&"e"!==handle&&"ne"!==handle&&"se"!==handle&&(d=r,s=a,n=0),(r=c.left-a.x+p)<d&&(r=c.left-a.x+p)>-1*d&&"w"!==handle&&"nw"!==handle&&"sw"!==handle&&(d=r,s=a,n=p))}),MIN_DISTANCE>=l&&("n"==handle||"ne"==handle||"nw"==handle)?($("#guide-h").css("top",i.y).show(),a.position.top=i.y-o,a.size.height+=l):MIN_DISTANCE>=l&&("s"==handle||"sw"==handle||"se"==handle)?($("#guide-h").css("top",i.y).show(),a.size.height-=l+2*t):MIN_DISTANCE>=d&&("w"==handle||"sw"==handle||"nw"==handle)?($("#guide-v").css("left",s.x).show(),a.position.left=s.x-n,a.size.width+=d+1):MIN_DISTANCE>=d&&("e"==handle||"se"==handle||"ne"==handle)?($("#guide-v").css("left",s.x).show(),a.size.width-=d+2*t):$("#guide-v , #guide-h").hide()}if($(".ui-resizable-resizing").hasClass("svginside")){var g=a.size.width;$(".ui-resizable-resizing svg ").css("width",g);var v=a.size.height;$(".ui-resizable-resizing svg ").css("height",v)}if($(".ui-resizable-resizing").has("hasSVG")){var g=$(".ui-resizable-resizing").width(),v=$(".ui-resizable-resizing").height(),u=$(".ui-resizable-resizing .line2").attr("stroke-width");$(".ui-resizable-resizing .line1").attr("x2",g-2*u),$(".ui-resizable-resizing .line1").attr("y1",v-2*u),$(".ui-resizable-resizing .line2").attr("x2",g-2*u),$(".ui-resizable-resizing .line2").attr("y2",v-2*u),$(".ui-resizable-resizing svg").attr("height",v-2*u),$(".ui-resizable-resizing svg").attr("width",g-2*u)}if(gridsize>0){var f=a.position.left,m=a.position.top,p=a.size.width-1,h=a.size.height-1,b=a.position.left+p,w=a.position.top+h;snappedleft=Math.round(f/gridsize)*gridsize,snappedright=Math.round(b/gridsize)*gridsize,snappedtop=Math.round(m/gridsize)*gridsize,snappedbottom=Math.round(w/gridsize)*gridsize;{Math.abs(snappedleft-a.position.left),Math.abs(snappedright-a.position.left-p),Math.abs(snappedtop-a.position.top),Math.abs(snappedbottom-a.position.top-h)}"se"==handle&&(a.size.width=snappedright-f-2*t+1,a.size.height=snappedbottom-m-2*t+1),"e"==handle&&(a.size.width=snappedright-f-2*t+1),"s"==handle&&(a.size.height=snappedbottom-m-2*t+1),"w"==handle&&(a.size.width=b-snappedleft-2*t+1,a.position.left=snappedleft),"n"==handle&&(a.size.height=w-snappedtop-2*t+1,a.position.top=snappedtop),"nw"==handle&&(a.size.height=w-snappedtop-2*t+1,a.position.top=snappedtop,a.size.width=b-snappedleft-2*t+1,a.position.left=snappedleft),"ne"==handle&&(a.size.height=w-snappedtop-2*t+1,a.position.top=snappedtop,a.size.width=snappedright-f-2*t+1),"sw"==handle&&(a.size.width=b-snappedleft-2*t+1,a.position.left=snappedleft,a.size.height=snappedbottom-m-2*t+1)}if($(".dim").html("<b>W</b>: "+(a.size.width+2*t-1)+"px, <b>H</b>: "+(a.size.height+2*t-1)+"px"),$(this).has(".textnew").length){var k=$(this).find(".textnew");a.size.height=k.height(),k.css("width",a.size.width)}},stop:function(e,a){if($("#guide-v , #guide-h").hide(),$(this).addClass("selected"),$(".ui-resizable-resizing").hasClass("svginside")){var t=a.size.width;$(".ui-resizable-resizing svg ").css("width",t);var s=a.size.height;$(".ui-resizable-resizing svg ").css("height",s)}},snap:" .col ",handles:"all",autoHide:!0}),e.each(function(){$(this).resizable("option","alsoResize",$(this).find(".wirejr")),$(this).has(".textnew").length&&$(this).find(".ui-resizable-ne, .ui-resizable-nw, .ui-resizable-sw, .ui-resizable-se, .ui-resizable-n, .ui-resizable-s").remove()}),e.mouseover(function(){var a;a=$(multipaged?"#canvas .page:visible .selected":"#canvas .selected"),$.each(e,function(){$(this).bind("contextmenu",function(){1==a.length&&a.removeClass("selected"),$(this).addClass("selected")})}),isover=!0;var t=$(this),s=!1;$(document).bind("keydown",function(e){s||(s=!0,e.shiftKey&&1==isover&&t.draggable("disable"))})}).mouseout(function(){isover=!1,$(document).unbind("keydown");var e=$(this);e.hasClass("ui-draggable-disabled")&&e.draggable("enable")}),$(".grouped").length&&$(".grouped").resizable("destroy")}function MakeCanvasDrag(){$("#canvas-wrap").resizable({minWidth:320,minHeight:320,start:function(){wirepanel.hide();var e=$("#canvas").height();$("#canvas").css("width",cwidth+2),$("#canvas").css("height",e+2)},resize:function(e,a){cwidth=a.size.width,$(".canvassize").html("<b>canvas</b>: "+parseInt(a.size.width,10)+"/"+parseInt(a.size.height,10)+"px"),320===cwidth&&($canvaswrap.addClass("mobile").removeClass("browser-wrap , mobile-landscape"),imgs.eq(1).insertBefore(imgs.eq(2)),imgs.eq(0).insertAfter(imgs.eq(2)),$(".canvassize").html("<b>canvas</b>: "+$("#canvas").width()+"/"+$("#canvas").height()+"px")),cwidth>320&&($canvaswrap.removeClass("mobile , mobile-landscape").addClass("browser-wrap"),imgs.eq(0).insertBefore(imgs.eq(1)),imgs.eq(2).insertAfter(imgs.eq(1)),$(".canvassize").html("<b>canvas</b>: "+$("#canvas").width()+"/"+$("#canvas").height()+"px")),320===a.size.height&&($canvaswrap.addClass("mobile-landscape").removeClass("browser-wrap , mobile"),imgs.eq(2).insertBefore(imgs.eq(1)),imgs.eq(0).insertAfter(imgs.eq(1)),$(".canvassize").html("<b>canvas</b>: "+$("#canvas").width()+"/"+$("#canvas").height()+"px")),$("#canvas").css("width","100%"),$("#canvas").css("height","100%")},stop:function(e,a){supercanvas.css("height","100%"),cwidth=a.size.width,$canvaswrap.hasClass("mobile-landscape")&&(cwidth=480),$("#canvas .wire").resizable("option","maxWidth",cwidth),$(this).center(),updateCanvasInput()},alsoResize:".container",handles:"se"}).draggable({handle:"#browser",cursor:"move",containment:".container",stop:function(){parseInt($(this).css("top"),10)<80&&$(this).transition({top:"110px"}),offset_c=$("#canvas").offset()}}),$canvaswrap.find(".ui-resizable-se").addClass("icon-resize-full")}function delnow(){var e=$canvas.find(".selected");saveState(e),e.remove()}function positionwirepanel(){offset_c=$("#canvas-wrap").position();var e=$("#canvas div.selected"),a=(e.height(),e.width()),t=e.position(),s=t.top,i=t.left,n=s+offset_c.top-45,o=wirepanel.width(),r=i+a/2-o/2+offset_c.left;0>=r&&(r=0),wirepanel.css({top:n,left:r}).show()}function editme(e){var a=e;a.attr("data-changed","true"),a.length&&(render_edit_menu(),positionwirepanel())}function copynow(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");e.addClass("copying").resizable("destroy").draggable("destroy");var a="";e.each(function(){a+=$(this).outerHTML()}),localStorage.setItem("clipboard",a),makeDrag(e),e.removeClass("selected , copying"),$(".copied").fadeIn().delay(600).fadeOut(),pasteIndex=1}function cutnow(){if(multipaged)var e=$("#canvas .page:visible .selected");else var e=$("#canvas .selected");e.addClass("copying").resizable("destroy").draggable("destroy");var a="";e.each(function(){a+=$(this).outerHTML()}),localStorage.setItem("clipboard",a),$(".selected").remove(),$(".copied").fadeIn().delay(600).fadeOut(),pasteIndex=1}function paste(){$canvas.find(".selected").removeClass("selected");var e=localStorage.getItem("clipboard");activepage.append(e);var a=$canvas.find(".copying");makeDrag(a),$canvas.find(".copying.locked").length&&$canvas.find(".copying.locked").click(function(){$(this).addClass("selected"),$("#lock").addClass("pressed")});var t=[],s=1;activepage.find(".wirejr").not(".aa").each(function(){var e=parseInt($(this).css("zIndex"),10);e>s&&(s=e)}),$.each(a,function(e){var a="w"+(new Date).getTime()+e;t[e]=a;var i=$(this),n=i.position();i.attr("id",a).removeClass("copying").css({top:n.top+10*pasteIndex+"px",left:n.left+10*pasteIndex+"px"}).find(".wirejr").css({"z-index":s+pasteIndex}),i.is(".grouped")&&$.each(i.find(".wire.groupmember"),function(e){var a="w"+(new Date).getTime()+e;$(this).attr("id",a)})}),saveState("",t),pasteIndex+=1}function changeBorderWidth(e){if(saveState(),$(".selected").has(".wirejr").length)var a=activepage.find(".selected").not(".locked").find(".wirejr");else var a=$canvas.find(".selected").not(".locked");a.css("box-sizing","content-box");var t=parseInt(a.css("borderLeftWidth"),10),s=e,i=a.width()-2*parseInt(s,10)+2*t,n=a.height()-2*parseInt(s,10)+2*t;a.css({width:i+"px",height:n+"px","border-width":e}),a.css({width:i+"px",height:n+"px","border-width":s+"px"}),a.hasClass("svginside")&&$(".selected svg *").css("stroke-width",s),a.hasClass("hasSVG")&&($(".selected svg line").attr("stroke-width",s),$(".selected svg .line1").attr({y1:n,x2:i}),$(".selected svg .line2").attr({y2:n,x2:i}),$(".selected svg").attr({height:n,width:i})),$(".dim").html("<b>W</b>: "+(a.outerWidth()-1)+"px, <b>H</b>: "+(a.outerWidth()-1)+"px")}function changeBackgroundColor(e){saveState();var a=e;if($(".selected").has(".wirejr").length)var t=activepage.find(".selected").not(".locked").find(".wirejr");else var t=$canvas.find(".selected").not(".locked");t&&(t.css("background-color",a),t.hasClass("headline")&&t.find("span").css("background-color",a),t.hasClass("headlinetxt")&&t.find("span").css("color",a),t.hasClass("paragraph")&&t.find("span").css("background-color",a),t.hasClass("list")&&(t.find("span").css({"background-color":a,color:a}),t.attr("data-color",a))),t.hasClass("svginside")&&$(".selected .image *").css("background-color",a)}function changeBorderColor(e){if(saveState(),$(".selected").has(".wirejr").length)var a=activepage.find(".selected").not(".locked").find(".wirejr");else var a=$canvas.find(".selected").not(".locked");current_brcolor=e,a.css("border-color",current_brcolor),a.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor),a.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor)}function bring_to_front(){if(saveState(),$(".selected").has(".wirejr").length)var e=activepage.find(".selected").not(".locked").find(".wirejr"),a=$(".wirejr");else var e=$canvas.find(".selected").not(".locked"),a=$(".wire");a.each(function(){var e=parseInt($(this).css("zIndex"),10);e>index_highest&&(index_highest=e)}),e.css("z-index",index_highest+1)}function send_to_back(){if(saveState(),$(".selected").has(".wirejr").length)var e=activepage.find(".selected").not(".locked").find(".wirejr");else var e=$canvas.find(".selected").not(".locked");$(".wirejr").each(function(){var e=parseInt($(this).css("zIndex"),10);$(this).css("z-index",e+1)}),e.css("zIndex",1)}function send_backward(){if(saveState(),$(".selected").has(".wirejr").length)var e=activepage.find(".selected").not(".locked").find(".wirejr");else var e=$canvas.find(".selected").not(".locked");var a=parseInt(e.css("zIndex"),10);a=0>=a?1:a,e.css("z-index",a-1)}function bring_forward(){if(saveState(),$(".selected").has(".wirejr").length)var e=activepage.find(".selected").not(".locked").find(".wirejr");else var e=$canvas.find(".selected").not(".locked");var a=parseInt(e.css("zIndex"),10);e.css("z-index",a+1)}function computeGuidesForElement(e){var a=$(e);if(a.is(".col")){var t=a.position();ww=$("#canvas").width(),t.left+=.01*ww}else var t=a.position();if(a.is(".col"))var s=a.width(),i=a.height()-1;else var s=a.outerWidth()-1,i=a.outerHeight()-1;return[{type:"h",x:t.left,y:t.top},{type:"h",x:t.left,y:t.top+i},{type:"v",x:t.left,y:t.top},{type:"v",x:t.left+s,y:t.top}]}function computeColForElement(e){var a=$(e),t=a.position();ww=$("#canvas").width(),t.left+=.01*ww;var s=a.width();return[t.left+1,t.left+s]}function aspect_ratio(e){var a=e.width(),t=e.height(),s=a/t;s>=.3&&4>=s&&($(".icon.rect").show(),$(".icon:not(.rect)").hide()),.3>s&&($(".icon.vertical").show(),$(".icon:not(.vertical)").hide()),s>4&&($(".icon.horizontal").show(),$(".icon:not(.horizontal)").hide()),$("#annotate").hide(),$("#textinput").addClass("lasticon")}function render_edit_menu(){$("#icons").hide().siblings().not("#lock , #unlock , #linklist").show(),$("#linklist").hide();var e=$("#canvas div.selected");if(e.has(".wirejr").length)var a=e.find(".wirejr");else var a=e;$showbg.hide(),a.hasClass("paragraph")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.show(),$edittxt.hide()),a.hasClass("list")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$("#textsize").show(),$("#textalign").hide(),$edittxt.hide()),a.hasClass("headlinetxt")||a.hasClass("paragraph")||a.hasClass("list")||($edittxt.hide(),$("#show-border").show(),$("#brind-back-front").show(),$colorpickers.show(),$bordercolors.hide(),$strokes.show(),$textalsz.hide()),(a.hasClass("headlinetxt")||a.hasClass("headline"))&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.show(),$edittxt.show())}function getRandomNumber(e){return Math.floor(Math.random()*e)}function getRandomChar(){var e="0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ";return e.substr(getRandomNumber(62),1)}function randomID(e){for(var a="",t=0;e>t;t++)a+=getRandomChar();return a}function demo0(){$("#canvas").append("<div id='demo'><div class='demoinfo'>Click & drag to draw</div><div id='demobox' ></div><div id='democursor'><i class='icon-cursor'></i></div><div id='demopanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div id='demoeditpanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>"),$("#demobox").css({width:"0",height:"0"}).removeAttr("class"),$(".demoinfo").text("Click & drag to draw"),$("#demo").fadeIn("slow",demo1)}function demo1(){$("#democursor").animate({top:"40px",left:"20px"},1500,demo1a)}function demo1a(){$("#democursor").addClass("drag"),demo2()}function demo2(){$("#demobox").delay(500).animate({width:"240px",height:"160px"},3500),$("#democursor").delay(500).animate({top:"200px",left:"260px"},3500,demo3)}function demo3(){$("#democursor").removeClass("drag"),$("#demopanel").delay(500).show(0,demo4)}function demo4(){$(".demoinfo").text("Select stencil"),$("#democursor").delay(800).animate({top:"125px",left:"55px"},1500,demo5)}function demo4a(){demo5()}function demo5(){$("#demobox").addClass("demobox"),$("#democursor").delay(800).animate({top:"125px",left:"80px"},500,demo5a)}function demo5a(){$("#demobox").addClass("round"),$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5b)}function demo5b(){$("#demobox").addClass("demoround"),$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5c)}function demo5c(){$("#democursor").addClass("drag"),demo5d()}function demo5d(){$("#demopanel").delay(300).hide(0,demo5e)}function demo5e(){$("#democursor").removeClass("drag"),demo6()}function demo6(){$("#demopanel").delay(1500).hide(0,demo6a)}function demo6a(){$(".demoinfo").text("Doubleclick to edit"),$("#democursor").addClass("drag"),$("#demopanel").delay(200).hide(0,demo6b)}function demo6b(){$("#democursor").removeClass("drag"),demo6c()}function demo6c(){$("#demopanel").delay(200).hide(0,demo6d)}function demo6d(){$("#democursor").addClass("drag"),$("#demopanel").delay(200).hide(0,demo6e)}function demo6e(){$("#democursor").removeClass("drag"),$("#demoeditpanel").delay(400).show(0,demo7)}function demo7(){$("#democursor").delay(800).animate({top:"125px",left:"178px"},500,demo7a)}function demo7a(){$("#demopanel").delay(500).hide(0,demo7b)}function demo7b(){$("#democursor").addClass("drag"),$("#demobox").addClass("grey"),demo7c()}function demo7c(){$("#demoeditpanel").delay(300).hide(0,demo7d)}function demo7d(){$("#democursor").removeClass("drag"),demo8()}function demo8(){$("#demo").delay(1600).hide("slow")}function updategrid(e){for(var a=0;5>a;a++){var t="#grid-pattern .lineV:eq("+[a]+")",s="#grid-pattern .lineH:eq("+[a]+")";$(s).attr({y1:[a+1]*e,y2:[a+1]*e,x2:5*e}),$(t).attr({x1:[a+1]*e,x2:[a+1]*e,y2:5*e}),$(".svgdot").attr({cx:e-.5,cy:e-.5})}$("#grid-pattern").attr({width:5*e,height:5*e}),$("#dot-pattern").attr({width:e,height:e})}function turngridon(){$("#snap-to-grid").attr("checked")&&("graph"==$("select#grid-type").val()?(gridsize=$("#grid-slider").slider("value"),$canvaswrap.attr("snappy",gridsize)):"dots"==$("select#grid-type").val()?(gridsize=$("#grid-slider").slider("value"),$canvaswrap.attr("snappy",gridsize)):"col"==$("select#grid-type").val()&&($canvaswrap.attr("snappy","col"),gridsize=0))}function saveState(e,a,t,s){var i=[];if("undefined"==typeof e)var e=$canvas.find(".selected");a?i={deleteid:a}:$.each(e,function(e){var a=$(this),t=a.getId();i[e]={html:a.find("div").first().outerHTML(),css:{top:a.css("top"),left:a.css("left"),width:a.css("width"),height:a.css("height")},id:t,orgclass:a.attr("class"),parent:a.parent().attr("id")}});var n;t?n=future:(n=historystate,s||(future=[],$("#redo").removeClass("inactive"))),n.unshift(i),n.length>6&&n.pop(),$("#undo").hasClass("inactive")&&$("#undo").removeClass("inactive")}function restoreState(e){var a;if(a=e?historystate:future,a.length>0){var t=a[0],s=$();if(t.deleteid)deletePasted(t,e);else{$.each(t,function(e){s=s.add($("#"+t[e].id))}),$("#"+t[0].id).length&&saveState(s,!1,e,!0);var i,n=!1,o=[];for(i=0;i<t.length;++i)$("#"+t[i].id).length&&!$("#"+t[i].id).is(".groupmember")?$("#"+t[i].id).resizable("destroy").draggable("destroy").css(t[i].css).html(t[i].html):($("<div/>").appendTo($("#"+t[i].parent)).addClass(t[i].orgclass).removeClass("ui-draggable ui-resizable ui-resizable-autohide").html(t[i].html).attr("id",t[i].id).css(t[i].css),s=s.add($("#"+t[i].id)),o[i]=t[i].id,n=!0);n&&saveState("",o,e,!0),makeDrag(s)}a.shift(),$("#redo").hasClass("inactive")&&$("#redo").removeClass("inactive"),e||a.length||($("#redo").addClass("inactive"),$("#undo").removeClass("inactive")),e&&!a.length&&$("#undo").addClass("inactive")}else $("#undo").addClass("inactive")}function deletePasted(e,a){var t=$();$.each(e.deleteid,function(){$("#"+this).is(".grouped")?ungroup_elements($("#"+this)):t=t.add($("#"+this))}),saveState(t,!1,a),t.remove()}function makeDragNow(){historystate.shift(),activepage=$(multipaged?".page:visible":"#canvas"),useboxer(),renderContextMenu(),makeDrag($("#canvas .wire")),$("#canvas").mousemove(function(e){$(".coord").html("<b>X</b>: "+parseInt(e.pageX-offset_c.left,10)+" <b>Y</b>: "+parseInt(e.pageY-offset_c.top,10))})}function saveUndo(){future.length>4&&future.pop()}function handleKeys(e){if(console.log("hk"),!$ajaxlogin.is(":visible")&&!activepage.find("textarea.editingtext").length){switch(draggable=$("#canvas .selected"),distance=1,gridsize>0&&(distance=gridsize),pTopArray=[],pLeftArray=[],37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode||e.ctrlKey||(saveState(),draggable.each(function(e){thiscsstop=$(this).css("top"),thiscssleft=$(this).css("left"),pTopArray[e]=parseInt(thiscsstop,10),pLeftArray[e]=parseInt(thiscssleft,10)})),e.keyCode){case 37:draggable.each(function(e){$(this).css("left",pLeftArray[e]-distance)});break;case 38:draggable.each(function(e){$(this).css("top",pTopArray[e]-distance)});break;case 39:draggable.each(function(e){$(this).css("left",pLeftArray[e]+distance)});break;case 40:draggable.each(function(e){$(this).css("top",pTopArray[e]+distance)});break;default:return!0}e.preventDefault()}}function group_ungroup(){if(multipaged)var e=activepage.find(".selected").not(".locked");
else var e=$canvas.find(".selected").not(".locked");e.hasClass("grouped")?e.hasClass("grouped")&&e.not("grouped")?(ungroup_elements($("#canvas .selected.grouped")),group_elements(e)):e.hasClass("grouped")&&!e.not("grouped")&&ungroup_elements($("#canvas .selected.grouped")):group_elements(e)}function group_elements(e){if(e.length>1){var a=1e4,t=1e4,s=-1,i=-1;e.each(function(){var e=$(this).position(),n=$(this).width(),o=$(this).height();a=a<e.top?a:e.top,t=t<e.left?t:e.left,s=s>e.left+n?s:e.left+n,i=i>e.top+o?i:e.top+o});var n=Math.floor(99999*Math.random());e.draggable("destroy").resizable("destroy").css({position:"absolute"}).removeClass("selected").addClass("groupmember"),e.wrapAll('<div  style="position:relative; top:-'+a+"px; left:-"+t+'px;"/>'),e.parent().wrap('<div class="grouped wire" id='+n+' style="position:absolute;top:'+a+"px; left:"+t+"px;width:"+(s-t+2)+"px;height:"+(i-a+2)+'px;"/>'),e.parent().parent().addClass("selected");var o=$("#"+n);makeDrag(o),o.resizable("destroy"),console.log("saved ids: "+[n]),saveState("",[n]),$("#group").addClass("pressed")}}function ungroup_elements(e){e.draggable("destroy").resizable("destroy"),e.each(function(){var e=$(this).find(".wire"),a=$(this).position(),t=e.parent().position();$(this).find(".groupmember").unwrap().unwrap(),e.each(function(){abspos=$(this).position(),$(this).css({top:a.top+(abspos.top+t.top),left:a.left+(abspos.left+t.left)})}),e.removeClass("groupmember"),makeDrag(e),$("#group").removeClass("pressed")})}function sortdivs(e,a){for(var t=new Array,s=0;s<e.length;s++)pos=e.eq(s).position(),t.push("top"==a?{div:e.eq(s),val:pos.top}:{div:e.eq(s),val:pos.left});var i=t.sort(function(e,a){return e.val<a.val?-1:e.val>a.val?1:0});return i}function renderContextMenu(){$("#canvas , #canvas .wire").contextPopup({title:"",items:[{label:"Copy",action:function(){copynow()},"short":"Ctrl+C"},{label:"Cut",action:function(){cutnow()},"short":"Ctrl+X"},{label:"Paste",action:function(){paste()},"short":"Ctrl+V"},{label:"Delete",action:function(){delnow()},"short":"Del"},null,{label:"Edit",action:function(){$(".selected").dblclick()},"short":"doubleclick"},null,{label:"Bring to front",action:function(){bring_to_front()},"short":"Ctrl+Shift+↑"},{label:"Bring forward",action:function(){bring_forward()},"short":"Ctrl+↑"},{label:"Send to back",action:function(){send_to_back()},"short":"Ctrl+Shift+↓"},{label:"Send backward",action:function(){send_backward()},"short":"Ctrl+↓"},null,{label:"Lock / Unlock",action:function(){lock()},"short":"Ctrl+L"},{label:"Group / Ungroup",action:function(){group_ungroup()},"short":"Ctrl+G"},{label:"Link",action:function(){makeLink()},"short":"Ctrl+K"}]})}function add_new_page(){apprise("Enter new name",{verify:!0,input:!0},function(e){if(!e)return!1;var a=$.now();$("#canvas").append("<div class='page' id='"+a+"' data-pagename='"+e+"'>"),pagelist.append($("<li>").attr({"data-pageid":a}).append(e).click(function(){make_page_active($(this).attr("data-pageid"))})),make_page_active(a),$(".pagename-wrap").click()})}function make_page_active(e){var a=$("[data-pageid="+e+"]"),t=a.text();$(".pagename").text(t),activepage.hide(),activepage=$("#"+e),activepage.show().siblings(".page").hide(),$(".sitemap li").removeClass("activepage"),a.addClass("activepage"),previewMode?(0==$("#canvas .page:visible").next(".page").length?$("#next").addClass("inactive"):$("#next").removeClass("inactive"),0==$("#canvas .page:visible").prev(".page").length?$("#prev").addClass("inactive"):$("#prev").removeClass("inactive")):useboxer(),wirepanel.hide(),$("#canvas").show()}function makeLink(){if($(".page").length){var e=$("#linkselect");e.empty(),e.append($("<option>").append("None").attr("value",0)),$(".sitemap ul li").each(function(){e.append($("<option>").append($(this).text()).attr("value",$(this).attr("data-pageid")))});var a=$("#canvas .page:visible .selected").attr("data-link");a&&$("#linkselect option[value="+a+"]").attr("selected",!0),$("#linklist").show().siblings().hide(),positionwirepanel(),wirepanel.show(),e.change(function(){var e=$("#linkselect option:selected").attr("value");$("#canvas .page:visible .selected").attr("data-link",e).addClass("icon-link"),wirepanel.hide()})}else alert("You need to be a Premium user to make clickable wireframes.")}function preview(){previewMode||($("#top").addClass("topup"),supercanvas.removeClass("slide-left , slide-right , slide-down"),exportbtn.removeClass("pressed"),$(".bottomright, #wirepanel").hide(),$("#canvas .page .wire").draggable("destroy").resizable("destroy").removeClass("ui-resizable-autohide"),$("#canvas").addClass("preview"),$("#canvas .ui-boxer").boxer("destroy"),$("#canvas .page").bind("click",highlightclickable),$("#canvas .page .wire[data-link]").bind("click",gotopage))}function highlightclickable(){var e=$("#canvas .page:visible .wire[data-link]");e.stop(!0,!0).addClass("hilite").delay(600).queue(function(){e.removeClass("hilite")})}function makeEditable(){$("#top").removeClass("topup"),$(".bottomright").show(),$("#canvas").removeClass("preview"),makeDrag($(".wire").not(".headlinetxt")),$(".wire[data-link]").unbind("click",gotopage),$("#canvas .page").unbind("click",highlightclickable),useboxer()}function saveComment(){$savecomment.show(),console.log("ready to save"),$savecomment.bind("click",function(){$("#canvas .page .publiccomment ,#canvas .page .aa").resizable("destroy").draggable("destroy");var e="";$("#canvas .page .publiccomment , #canvas .page .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),e+=$(this).outerHTML()});var a=encodeURIComponent(e);$.post("../savecomment",{pblcaa:a,preview:previewid},function(){$(".saved").show().delay(600).fadeOut(),$("#canvas .page .publiccomment").draggable({stop:function(){saveComment()}}).resizable({handles:"all",stop:function(){saveComment()}}),$savecomment.unbind("click"),$savecomment.hide(),console.log("saved")})})}function positionAA(){$(".publiccomment , .aa").each(function(){$(this).appendTo($("#"+$(this).attr("data-parent")))}),$(".publiccomment").draggable({stop:function(){saveComment()}}).resizable({handles:"all",stop:function(){saveComment()}})}if($(function(){$canvas.offset();if($(".editable").editnibble("hideAllEditors"),$("#show-bg").hide(),$("#canvas .txtcont span:empty").length&&$(".txtcont span:empty").text(paragraphtext),$("#canvas .listcont:empty").length){var e=$(".listcont:empty");e.each(function(){var e=$(this).parent().attr("data-color");$(this).html(list).find("li span").css({"background-color":e})})}var a=0,t=0,s=$("#canvas .page:visible");$("#canvas .page").show(),$("#canvas .wire").each(function(){t=$(this).offset().top+$(this).height(),t>a&&(a=t)}),$("#canvas .page").hide(),s.show();var i=$canvas.height();if(i>600&&($(".container").css({"overflow-y":"auto",height:parseInt(i,10)+250+"px"}),i>=a?supercanvas.css("height","100%"):supercanvas.css("height","100%")),!$("#canvas #grid-div").length){$("#canvas").prepend($(".grids").show().contents().unwrap()),$("#show-grid").attr("checked",!0);var n=$canvaswrap.attr("data-grid");switch(n){case"graph":$("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("select#grid-type").val("graph");break;case"dots":$("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$("select#grid-type").val("dots");break;case"col":$("#gridcol").show(),$("#grid-div , #grid-dot").hide(),$("select#grid-type").val("col");break;default:$("#grid-div , #grid-dot , #gridcol").hide(),$("#show-grid").attr("checked",!1)}}$canvaswrap.hasClass("mobile")&&!$canvaswrap.hasClass("tablet")&&$(".device-mobile").insertBefore($(".device-window")),$canvaswrap.hasClass("mobile-landscape")&&$(".device-mobile-landscp").insertBefore($(".device-window")),$canvaswrap.hasClass("tablet")&&$(".device-tablet").insertBefore($(".device-window")),imgs=$(".device-wrap span"),$("#canvas .wire").has(".headlinetxt").addClass("hastext"),$(".textnew.ui-draggable").draggable("destroy"),$canvaswrap.center(),$("#canvas .locked").draggable("destroy").resizable("destroy"),$("#sitemaplist").sortable({placeholder:"ui-state-highlight",containmentType:"div.sitemap",start:function(e,a){$(document).data("oldpos",a.item.index())},stop:function(e,a){var t=a.item.index(),s=a.item.attr("data-pageid");console.log($(document).data("oldpos")+" "+t),$(document).data("oldpos")>t?$("#canvas #"+s).insertBefore($("#canvas .page:eq("+t+")")):$(document).data("oldpos")<t&&$("#canvas #"+s).insertAfter($("#canvas .page:eq("+t+")"))}}).disableSelection("#sitemaplist li")}),$("#canvas .wire").not("#canvas .wire:has(.wirejr)").css({"border-style":"solid"}),$("#canvas .page").length)var multipaged=!0;var multipaged,supercanvas=$(".supercanvas"),exporting=$(".exporting"),gridsize=0,imgs,wirePresent=!0,wirepanel=$("#wirepanel"),annotPresent=!0,offset_c=$("#canvas").offset(),cwidth=$("#canvas-wrap").width(),MIN_DISTANCE=6,guides=[],innerOffsetX,innerOffsetY,offseta1=$("#canvas").offset(),defbw=1,defstrcolor="#444",defbgcolor="white",clonewidth=0,cloneheight=0,$canvaswrap=$("#canvas-wrap"),$canvas=$("#canvas"),index_highest=0,sttngs=$(".settings span i"),sett=$(".settings"),$sitemapicon=$("#sitemap icon i"),previewMode,$edittxt=$("#edittxt");$(".container").hasClass("preview")&&(previewMode=!0),$(document).ready(function(){setgridsize(),$(".left , .icon , .colorpicker , .brcolor , #show-border , .stroke_width , #edit , #edittxt , #front , #back , #show-bg , #lock , #unlock , .tooltip").tipsy({delayIn:600}),$(".device-wrap span ").tipsy({delayIn:1e3,gravity:"nw"}),$(document).keydown(function(e){var a=$(document.activeElement).hasClass("editingtext"),t=$(document.activeElement).hasClass("editor-form-element"),s=$(document.activeElement).hasClass("input"),i=$(".appriseInner").length,n=$ajaxlogin.is(":visible"),o=$("#canvas .selected").length;return 8!==e.keyCode||a||t||s||i||o?void(8!==e.keyCode||!o||a||s||t||i||n||(e.preventDefault(),$("#canvas .selected").remove())):!1}),updateCanvasInput(),previewMode||$(".aa").draggable().resizable({handles:"all"})}),positionAA(),$("#show-grid").bind("click",function(){$(this).is(":checked")?"graph"==$("select#grid-type").val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$canvaswrap.attr("data-grid","graph")):"dots"==$("select#grid-type").val()?($("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$canvaswrap.attr("data-grid","dots")):($("#gridcol").show(),$canvaswrap.attr("data-grid","col"),$("#grid-div , #grid-dot").hide()):($("#grid-div , #gridcol , #grid-dot").hide(),$canvaswrap.attr("data-grid",0))}),$("#gridcol").is(":visible")||$("#grid-div").is(":visible")||$("#show-grid").removeAttr("checked"),$("select#grid-type").change(function(){"graph"==$("select#grid-type").val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid","graph")):"dots"==$("select#grid-type").val()?($("#grid-dot").show(),$("#gridcol, #grid-div").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid","dots")):($("#gridcol").show(),gridsize=0,$("#grid-div , #grid-dot").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid","col"))}),$("#empty").click(function(){var e=confirm("Do you want to clear the canvas?");e===!0&&(window.location="/")});var imgs=$(".device-wrap span");$(".device-mobile").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.addClass("mobile").removeClass("browser-wrap , mobile-landscape , tablet").css({width:"320px",height:"480px"}).center(),$(".wire").resizable("option","maxWidth",320),offset_c=$("#canvas").offset(),supercanvas.css("height","100%"),updateCanvasInput(),imgs=$(".device-wrap span"))}),$(".device-tablet").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.addClass("mobile , tablet").removeClass("browser-wrap , mobile-landscape").css({width:"728px",height:"1024px"}).center(),$(".container").css("overflow-y","auto"),supercanvas.css("height","1350px"),$(".wire").resizable("option","maxWidth",728),offset_c=$("#canvas").offset(),imgs=$(".device-wrap span"),updateCanvasInput())}),$(".device-window").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.removeClass("mobile , tablet , mobile-landscape").addClass("browser-wrap").css({width:"820px",height:"480px"}).center(),$(".wire").resizable("option","maxWidth",820),offset_c=$("#canvas").offset(),updateCanvasInput(),supercanvas.css("height","100%"),imgs=$(".device-wrap span"))}),$(".device-mobile-landscp").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.addClass("mobile-landscape").removeClass("browser-wrap , mobile , tablet").css({width:"480px",height:"320px"}).center(),$(".wire").resizable("option","maxWidth",480),offset_c=$("#canvas").offset(),updateCanvasInput(),supercanvas.css("height","100%"),imgs=$(".device-wrap span"))}),$("#show-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").show(),$("#hide-annotation").show(),$(this).hide()}),$("#hide-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").hide(),$("#show-annotation").show(),$(this).hide()}),$("#edit-wire").click(function(){$("#canvas .selected").dblclick()}),$("#lock").click(function(){lock()});var $ajaxlogin=$("#ajaxlogin"),supports_pushState="pushState"in history;if($("#save").click(function(){$("#canvas .page:visible .selected").removeClass("selected"),$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var e=supercanvas.clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().htmlClean().html(),a=encodeURIComponent(e),t="";$("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),t+=$(this).outerHTML()});var s=encodeURIComponent(t);$.ajax({type:"POST",url:"../save",data:{note:a,name:filename,aa:s},success:function(i){switch(i){case"login":localStorage.setItem(filename,e),localStorage.setItem(filename+"aa",t),$ajaxlogin.find(".wrongpass").hide(),$ajaxlogin.show().submit(function(e){e.preventDefault(),$.ajax({type:"POST",url:"../ps/ajaxlogin.php",data:$ajaxlogin.serialize(),success:function(e){console.log(e),0==e?$ajaxlogin.find(".wrongpass").show():$.ajax({type:"POST",url:"../save",data:{note:a,name:filename,aa:s},success:function(){$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),makeDrag($("#canvas .wire")),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"}),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa"),$ajaxlogin.hide(),_paq.push(["trackGoal",3])}})}})}),_paq.push(["trackGoal",2]);break;default:$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),makeDrag($("#canvas .wire")),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"}),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa")}},error:function(){localStorage.setItem(filename,e),localStorage.setItem(filename+"aa",t),MakeCanvasDrag(),makeDrag($("#canvas .wire")),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"}),_paq.push(["trackGoal",1])}})}),$("#fork").click(function(){$("#canvas .page:visible .selected").removeClass("selected"),$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var e=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().htmlClean().html(),a=encodeURIComponent(e),t="";$("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),t+=$(this).outerHTML()});var s=encodeURIComponent(t),i=$.now();$.post("../fork",{note:a,name:filename,aa:s,timestamp:i},function(){console.log(i),$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),makeDrag($(".wire")),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"})})}),$("#savefree").click(function(){var e=!0;$("#canvas .selected").removeClass("selected"),$("#canvas .wire , #canvas .aa ").draggable("destroy").resizable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var a=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().htmlClean().html(),t=encodeURIComponent(a);0===filename?filename=randomID(6):e=!1,supports_pushState?history.pushState({},"filename","/"+filename):location.hash="#"+filename,$.post("save.php",{note:t,name:filename},function(){MakeCanvasDrag(),e?($(".savedURL").html("http://wireframe.cc/"+filename),$(".save-wrap").fadeIn().delay(1600).fadeOut()):$(".saved").fadeIn().delay(600).fadeOut(),makeDrag($("#canvas .wire")),makeDrag($("#canvas .aa"))})}),$("#slogan").length||$(".controls").fadeIn(),$(".orstart").click(InstantShowSaveButton),$(".closeannot , .closeURLpopup").click(function(){var e=$(this).parent();e.remove(),previewMode&&saveComment()}),$(".ok").click(editableTextBlurred),$canvas.bind("editThisText",".textme",edittext),$.widget("ui.boxer",$.extend({},$.ui.mouse,{_init:function(){this.element.addClass("ui-boxer"),this.dragged=!1,this._mouseInit(),this.helper=$(document.createElement("div")).css({background:"rgba(0,0,0,0.7)"}).addClass("ui-boxer-helper"),$(".dim").html("<b>W</b>: 0px, <b>H</b>: 0px")},destroy:function(){return this.element.removeClass("ui-boxer ui-boxer-disabled").removeData("boxer").unbind(".boxer"),this._mouseDestroy(),this},_mouseStart:function(e){wirepanel.hide(),1==$("#show-grid").attr("checked")&&"col"==$("select#grid-type").val()&&1==$("#snap-to-grid").attr("checked")&&(guides=$.map($(".col"),computeColForElement)),e.ctrlKey||e.shiftKey||e.metaKey||$("#canvas .selected").removeClass("selected"),$("#canvas .latestwire").removeClass("latestwire"),$("#lock , #group").removeClass("pressed"),$(".blank").remove();if(this.opos=[e.pageX,e.pageY],!this.options.disabled){var a=this.options;this._trigger("start",e),$(a.appendTo).append(this.helper),this.helper.css({"z-index":1e3,position:"absolute",left:e.clientX,top:e.clientY,width:0,height:0})}},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var a=(this.options,this.opos[0]),t=this.opos[1],s=e.pageX,i=e.pageY;if(a>s&&t>i&&this.helper.addClass("selecting"),a>s){var n=s;s=a,a=n}if(t>i){var o=i;i=t,t=o}if(this.helper.css({left:a,top:t,width:s-a,height:i-t}),!this.helper.hasClass("selecting")){var r=.1+(s-a)/cwidth;r>=.7&&(r=.7),this.helper.css({left:a,top:t,width:s-a,height:i-t}).css({background:"rgba(0,0,0,"+r+") url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAIUlEQVQYV2NkYGCQBGJ08BxdgHGIKMTiF0wPgjwz2BUCADTeBYguWvyCAAAAAElFTkSuQmCC)"})}return $(".dim").html("<b>W</b>: "+parseInt(s-a-1,10)+"px, <b>H</b>: "+parseInt(i-t-1,10)+"px"),this._trigger("drag",e),!1}},_mouseStop:function(e){function a(e,a){for(var t=a[0],s=Math.abs(e-t),i=0;i<a.length;i++){var n=Math.abs(e-a[i]);s>n&&(s=n,t=a[i])}return t}$(".dimnow").remove();this.dragged=!1;var t=(this.options,this.opos[0]),s=this.opos[1],i=e.pageX,n=e.pageY;if(t>i){var o=i;i=t,t=o}if(s>n){var r=n;n=s,s=r}var d=$("#canvas").offset();$(".wirejr").each(function(){var e=parseInt($(this).css("zIndex"),10);e>index_highest&&(index_highest=e)});var l=t-d.left,c=s-d.top;if(clonewidth=i-t-2,cloneheight=n-s-2,gridsize>0){l=Math.round(l/gridsize)*gridsize,c=Math.round(c/gridsize)*gridsize,clonewidth=Math.round(clonewidth/gridsize)*gridsize,cloneheight=Math.round(cloneheight/gridsize)*gridsize;var p=this.helper.clone().css({left:l,top:c,"z-index":index_highest+1,width:clonewidth,height:cloneheight}).removeClass("ui-boxer-helper").appendTo(this.element).addClass("brandnew blank");$(".dim").html(l>20?"<b>W</b>: "+clonewidth+"px, <b>H</b>: "+cloneheight+"px":"<b>W</b>: 0px, <b>H</b>: 0px")}else if("col"==$("select#grid-type").val()&&1==$("#snap-to-grid").attr("checked"))if(clonewidth>20||cloneheight>20){guides1=[],guides2=[];for(var h=0;h<guides.length;h+=2)guides1.push(guides[h]);for(var h=1;h<guides.length;h+=2)guides2.push(guides[h]);l=a(l,guides1),clonewidth=a(i-d.left,guides2)-l;var p=this.helper.clone().css({left:l,top:c,"z-index":index_highest+1,width:clonewidth,height:cloneheight}).removeClass("ui-boxer-helper").appendTo(this.element).addClass("brandnew blank");$(".dim").html(clonewidth>20||cloneheight>20?"<b>W</b>: "+clonewidth+"px, <b>H</b>: "+cloneheight+"px":"<b>W</b>: 0px, <b>H</b>: 0px")}else this.helper.remove();else{var g=0;$canvaswrap.hasClass("browser-wrap")||(g=1);var p=this.helper.clone().css({left:l-g,top:c-g,"z-index":index_highest+1}).removeClass("ui-boxer-helper").appendTo(this.element).addClass("brandnew blank");$(".dim").html(i-t>20?"<b>W</b>: "+(i-t-1)+"px, <b>H</b>: "+(n-s-1)+"px":"<b>W</b>: 0px, <b>H</b>: 0px")}return this._trigger("stop",e,{box:p}),this.helper.removeClass("selecting").css("background","transparent").remove(),!1}})),$.extend($.ui.boxer,{defaults:$.extend({},$.ui.mouse.defaults,{appendTo:"body",distance:0})}),$("#1").length)var activepage=$("#1");else var activepage=$("#canvas");useboxer(),wirepanel.delegate(".icon","hover",function(){var e=$(this);$canvas.find(".brandnew").length&&(type=e.attr("elementtype"),prepareWire())}),wirepanel.delegate(".icon","click",function(){insertWire()});var type,isover=!1;MakeCanvasDrag(),$("#del").click(function(){delnow()}),$("#edit").click(function(){$("#icons").show().siblings().hide(),$('.icon[elementtype="headlinetxt"]').hide(),positionwirepanel()}),$edittxt.click(function(){$canvas.find(".selected div.textme").trigger("editThisText"),wirepanel.hide()});var copied;posTopArray=[],posLeftArray=[],$("#copy").click(function(){copynow()}),$("#cut").click(function(){cutnow()}),key("ctrl+c, command+c",function(){copynow()}),key("ctrl+x, command+x",function(){cutnow()}),key("del",function(){delnow()}),key("backspace",function(e){e.preventDefault();var a=$(document.activeElement).hasClass("editingtext"),t=$(document.activeElement).hasClass("editor-form-element"),s=$(document.activeElement).hasClass("input"),i=$(".appriseInner").length,n=$ajaxlogin.is(":visible"),o=$canvas.find(".selected").length;return a||t||s||i||o?void(!o||a||s||t||i||n||(e.preventDefault(),delnow())):!1}),$("#paste").click(function(){paste()}),key("ctrl+v, command+v",function(){paste()});var pasteIndex=1;$(".colorpicker").click(function(){var e=$(this).css("background-color");changeBackgroundColor(e)}),$(".strokeweight").click(function(){changeBorderWidth($(this).attr("stroke"))}),$.fn.getId=function(){if($(this).attr("id"))return $(this).attr("id");var e="w"+(new Date).getTime();return $(this).attr("id",e),e},$(".brcolor").click(function(){if(saveState(),$(".selected").has(".wirejr").length)var e=activepage.find(".selected").not(".locked").find(".wirejr");else var e=$canvas.find(".selected").not(".locked");current_brcolor=$(this).css("border-left-color"),e.css("border-color",current_brcolor),e.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor),e.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor)}),$("#front").click(function(){bring_to_front()}),$("#back").click(function(){send_to_back()}),$("#backward").click(function(){send_backward()}),$("#forward").click(function(){bring_forward()});var $showbg=$(" #show-bg"),$strokes=$("#strokes"),$showborderbg=$("#show-border , #show-bg"),$colorpickers=$("#colorpickers"),$bordercolors=$("#bordercolors"),$edittxt=$("#edittxt"),$textalsz=$("#textalign , #textsize");$("#show-bg").click(function(){$("#colorpickers").show(),$("#bordercolors").hide(),$("#show-border").show(),$("#show-bg").hide()}),$("#show-border").click(function(){$("#bordercolors").show(),$("#colorpickers").hide(),$("#show-border").hide(),$("#show-bg").show()}),$("#alignleft").click(function(){saveState(),$("#canvas .selected").find("span").css("text-align","left")}),$("#aligncenter").click(function(){saveState(),$("#canvas .selected").find("span").css("text-align","center")}),$("#alignright").click(function(){saveState(),$("#canvas .selected").find("span").css("text-align","right")}),$("#alignjustify").click(function(){saveState(),$("#canvas .selected").find("span").css("text-align","justify")}),$("#font-s").click(function(){saveState(),$("#canvas .selected.paragraph span , #canvas .selected .paragraph span").css({"font-size":"7px","line-height":"13px"}),$("#canvas .selected.list span ul li span , #canvas .selected .list span ul li span").css({"font-size":"7px","line-height":"13px"}),$("#canvas .selected.headlinetxt .editable .content-wrapper").css({"font-size":"12px","line-height":"12px"}),$("#canvas .selected.textnew , #canvas .selected .textnew").css({"font-size":"12px","line-height":"12px"}),$("#canvas .selected.headline , #canvas .selected .headline").find(".headtext span ").css({"font-size":"14px","line-height":"14px","margin-bottom":"2px"})}),$("#font-m").click(function(){saveState(),$("#canvas .selected.paragraph span , #canvas .selected .paragraph span").css({"font-size":"10px","line-height":"20px"}),$("#canvas .selected.list span ul li span , #canvas .selected .list span ul li span").css({"font-size":"10px","line-height":"20px"}),$("#canvas .selected.headlinetxt .editable .content-wrapper").css({"font-size":"18px","line-height":"18px"}),$("#canvas .selected.textnew , #canvas .selected .textnew").css({"font-size":"18px","line-height":"18px"}),$("#canvas .selected.headline , #canvas .selected .headline").find(".headtext span").css({"font-size":"22px","line-height":"22px","margin-bottom":"6px"})}),$("#font-l").click(function(){saveState(),$("#canvas .selected.paragraph span , #canvas .selected .paragraph span").css({"font-size":"18px","line-height":"36px"}),$("#canvas .selected.list span ul li span , #canvas .selected .list span ul li span").css({"font-size":"18px","line-height":"36px"}),$("#canvas .selected.headlinetxt .editable .content-wrapper").css({"font-size":"28px","line-height":"28px"}),$("#canvas .selected.textnew , #canvas .selected .textnew").css({"font-size":"28px","line-height":"28px"}),$("#canvas .selected.headline , #canvas .selected .headline").find(".headtext span ").css({"font-size":"28px","line-height":"28px","margin-bottom":"8px"})}),jQuery.fn.center=function(e){return e=e?this.parent():window,this.transition({left:($(e).width()-this.outerWidth())/2+$(e).scrollLeft()+"px","margin-left":"0"}),this};var annotationhtml="<span class=annotbox><div class='editme thelatest'></div><button class=ok><i class=icon-ok></i> ok</button></span><div class=closeannot><i class=icon-remove></i></div>",texthtml="<span class='text'><div class='textme thelatest'></div></span>",paragraph="<span class=txtcont><span>Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iise mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.</span></span>",paragraphtext="Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.",list="<span class='listcont'><ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul></span>",listhtml="<ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul>",headtxt="<span class='headtext'><span>Lorem</span> <span>ipsum</span> <span>dolor</span> <span>sitammet</span> <span>quam</span> <span>Lorem</span> <span>ipsumdolor</span> <span>sitammet</span> <span>quam</span></span>",img="<svg id='imgwire' version='1.1' baseProfile='tiny'  xmlns='http://www.w3.org/2000/svg'  width='200px' height='100px' viewBox='0 0 200 100' preserveAspectRatio='none'><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='100' x2='200' y2='0'/><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='0' x2='200' y2='100'/></svg>";
$("#watch-demo").click(function(){$(".panel").is(":visible")||demo0()}),previewMode?$("#canvas .publiccomment .annotbox div").click(divClicked):$("#canvas .annotbox div").click(divClicked),$canvas.find(".aa").length&&$("#hide-annotation").show(),$canvas.find(".aa:hidden").length&&($("#hide-annotation").hide(),$("#show-annotation").show());var delay=function(){var e=0;return function(a,t){clearTimeout(e),e=setTimeout(a,t)}}();$(window).resize(function(){delay(function(){$canvaswrap.center()},500)}),$("#grid-slider").slider({min:10,max:50,value:20,slide:function(e,a){$(".grid-size-val").text(a.value)},stop:function(e,a){updategrid(a.value),turngridon()}}),$("#snap-to-grid , #grid-type").change(function(){turngridon(),$("#snap-to-grid").attr("checked")||($canvaswrap.attr("snappy",0),gridsize=0)}),$canvaswrap.data("savedState",[]),$canvaswrap.data("savedUndo",[]);var historystate=$canvaswrap.data("savedState"),future=$canvaswrap.data("savedUndo");key("ctrl+z, command+z",function(e){e.preventDefault(),restoreState(!0)}),$("#undo").click(function(){restoreState(!0)}),key("ctrl+y, command+y, command+shift+z",function(e){e.preventDefault(),restoreState(!1)}),$("#redo").click(function(){restoreState(!1)}),$("#canvas").mousemove(function(e){$(".coord").html("<b>X</b>: "+parseInt(e.pageX-offset_c.left,10)+" <b>Y</b>: "+parseInt(e.pageY-offset_c.top,10))}),sett.bind("click",function(){wirepanel.hide(),supercanvas.hasClass("slide-down")?supercanvas.removeClass("slide-down").delay(600).queue(function(e){sharebar.hide(),sett.toggleClass("pressed"),exportbtn.removeClass("pressed"),supercanvas.toggleClass("slide-left"),e()}):(sharebar.hide(),exportbtn.removeClass("pressed"),supercanvas.removeClass("slide-right , slide-down"),supercanvas.toggleClass("slide-left"),$(this).toggleClass("pressed "),$(this).find("i").toggleClass("icon-arrow-right"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"))}),$("select#def-stroke-width").change(function(){defbw=$("select#def-stroke-width").val()}),$("select#def-stroke-color").change(function(){defstrcolor=$("select#def-stroke-color").val()}),$("select#def-bg-color").change(function(){defbgcolor=$("select#def-bg-color").val()}),$("#canvas_w_val").change(function(){$canvaswrap.width(parseInt($(this).val(),10)),$(".wire").resizable("option","maxWidth",$(this).val()),updateCanvasInput(),$canvaswrap.center()}),$("#canvas_h_val").change(function(){$(this).val()>600&&($(".container").css("overflow-y","auto"),supercanvas.css({height:parseInt($(this).val(),10)+250+"px"})),$canvaswrap.css("height",$(this).val()+"px"),updateCanvasInput()}),key("down",function(e){handleKeys(e)}),key("up",function(e){handleKeys(e)}),key("left",function(e){handleKeys(e)}),key("right",function(e){handleKeys(e)}),$("#group").click(function(){group_ungroup()}),key("ctrl+g, command+g",function(e){if(e.preventDefault(),multipaged)var a=activepage.find(".selected").not(".locked");else var a=$canvas.find(".selected").not(".locked");group_elements(a)}),key("ctrl+shift+g, command+shift+g",function(e){e.preventDefault(),ungroup_elements($("#canvas .selected.grouped"))}),$("#align-top").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(1==e.length)e.css("top","1px");else{var a=1e4;e.each(function(){var e=$(this).position();a=a<e.top?a:e.top}),e.css("top",a+"px")}}),$("#align-left").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(1==e.length)e.css("left","1px");else{var a=1e4;e.each(function(){var e=$(this).position();a=a<e.left?a:e.left}),e.css("left",a+"px")}}),$("#align-right").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(1==e.length){var a=$("#canvas").width(),t=e.width(),s=parseInt(e.css("borderWidth"),10);e.css("left",a-t-2*s+1+"px")}else{var i=-1;e.each(function(){var e=$(this).position(),a=$(this).width();i=i>e.left+a?i:e.left+a}),e.each(function(){var e=$(this).width();$(this).css("left",i-e+"px")})}}),$("#align-bottom").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(1==e.length){var a=$("#canvas").height(),t=e.height(),s=parseInt(e.css("borderWidth"),10);e.css("top",a-t-2*s+1+"px")}else{var i=-1;e.each(function(){var e=$(this).position(),a=$(this).height();i=i>e.top+a?i:e.top+a}),e.each(function(){var e=$(this).height();$(this).css("top",i-e+"px")})}}),$("#align-center").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(1==e.length){var a=$("#canvas").height(),t=e.height();e.css("top",a/2-t/2+"px")}else{var s=-1,i=1e3;e.each(function(){var e=$(this).position(),a=$(this).height();s=s>e.top+a?s:e.top+a,i=i<e.top?i:e.top}),e.each(function(){var e=$(this).height();$(this).css("top",(s+i)/2-e/2+"px")})}}),$("#align-middle").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(1==e.length){var a=$("#canvas").width(),t=e.width();e.css("left",a/2-t/2+"px")}else{var s=-1,i=1e3;e.each(function(){var e=$(this).position(),a=$(this).width();s=s>e.left+a?s:e.left+a,i=i<e.left?i:e.left}),e.each(function(){var e=$(this).width();$(this).css("left",(s+i)/2-e/2+"px")})}}),$("#dist-v").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");var a=0;divide=e.length-1,obj=e,distrb=sortdivs(obj,"top"),maxTop=distrb[0].val+distrb[0].div.height()/2,last=distrb.length-1,maxBottom=distrb[last].val+distrb[last].div.height()/2,$.each(distrb,function(){thisdiv=this.div;var e=thisdiv.height();thisdiv.css("top",maxTop+(maxBottom-maxTop)/divide*a-e/2+"px"),a++})}),$("#dist-h").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");var a=0;divide=e.length-1,obj=e,distrb=sortdivs(obj,"left"),maxLeft=distrb[0].val+distrb[0].div.width()/2,last=distrb.length-1,maxRight=distrb[last].val+distrb[last].div.width()/2,$.each(distrb,function(){thisdiv=this.div;var e=thisdiv.width();thisdiv.css("left",maxLeft+(maxRight-maxLeft)/divide*a-e/2+"px"),a++})}),$("#align").click(function(){$(".align-icons").toggleClass("align-icons-visible"),$("#arrange-icons").hasClass("arrange-icons-visible")||$(".align-icons").siblings().toggleClass("inactive"),$(this).toggleClass("pressed"),$("#arrange-icons").hasClass("arrange-icons-visible")&&($("#arrange-icons").removeClass("arrange-icons-visible"),$("#arrange").removeClass("pressed"))}),$("#arrange").click(function(){$("#arrange-icons").toggleClass("arrange-icons-visible"),$(".align-icons").hasClass("align-icons-visible")||$("#arrange-icons").siblings().toggleClass("inactive"),$(this).toggleClass("pressed"),$(".align-icons").hasClass("align-icons-visible")&&($(".align-icons").removeClass("align-icons-visible"),$("#align").removeClass("pressed"))}),$(".inner-btn , #align , #arrange , .pagename-wrap , .appriseInner").click(function(e){e.stopPropagation()}),key("b",function(){type="box",prepareWire(),insertWire()}),key("r",function(){type="roundbox",prepareWire(),insertWire()}),key("e",function(){type="elipse",prepareWire(),insertWire()}),key("i",function(){type="image",prepareWire(),insertWire()}),key("p",function(){type="paragraph",prepareWire(),insertWire()}),key("l",function(){type="list",prepareWire(),insertWire()}),key("h",function(){type="headline",prepareWire(),insertWire()}),key("t",function(e){e.preventDefault(),type="headlinetxt",prepareWire(),insertWire()}),key("a",function(e){e.preventDefault(),type="annotate",prepareWire(),insertWire()}),key("g",function(e){e.preventDefault(),type="line_hor",prepareWire(),insertWire()}),key("v",function(e){e.preventDefault(),type="line_vert",prepareWire(),insertWire()}),key("s",function(e){e.preventDefault(),type="slider",prepareWire(),insertWire()}),key("u",function(e){e.preventDefault(),type="progressbar",prepareWire(),insertWire()}),key("c",function(e){e.preventDefault(),type="combobox",prepareWire(),insertWire()}),key("q",function(e){e.preventDefault(),type="scrollh",prepareWire(),insertWire()}),key("y",function(e){e.preventDefault(),type="scrollv",prepareWire(),insertWire()}),key("n",function(e){e.preventDefault(),type="textinput",prepareWire(),insertWire()}),key("6",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#111","border-color":"#111"})),$("#canvas .selected").length&&changeBackgroundColor("#111")}),key("5",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#444","border-color":"#444"})),$("#canvas .selected").length&&changeBackgroundColor("#444")}),key("4",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#777","border-color":"#777"})),$("#canvas .selected").length&&changeBackgroundColor("#777")}),key("3",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#aaa","border-color":"#aaa"})),$("#canvas .selected").length&&changeBackgroundColor("#aaa")}),key("2",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#ddd","border-color":"#ddd"})),$("#canvas .selected").length&&changeBackgroundColor("#ddd")}),key("1",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#fff","border-color":"#fff"})),$("#canvas .selected").length&&changeBackgroundColor("#fff")}),key("7",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"tomato","border-color":"tomato"})),$("#canvas .selected").length&&changeBackgroundColor("tomato")}),key("0",function(){$("#canvas .selected").length&&changeBackgroundColor("transarent")}),key("alt+7",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("tomato"))}),key("alt+1",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("white"))}),key("alt+2",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("#ddd"))}),key("alt+3",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("#aaa"))}),key("alt+4",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("#777"))}),key("alt+5",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("#444"))}),key("alt+6",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("#111"))}),key("alt+0",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("transparent"))}),key("ctrl+1",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderWidth("1"))}),key("ctrl+2",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderWidth("2"))}),key("ctrl+3",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderWidth("4"))}),key("ctrl+a, command+a",function(e){e.preventDefault(),multipaged?$(".page:visible .wire").not(".locked , .groupmember").addClass("selected"):$(".wire").not(".locked , .groupmember").addClass("selected")}),key("esc",function(e){e.preventDefault(),$(".selected").removeClass("selected")}),$(".container").hasClass("preview")||renderContextMenu(),key("ctrl+up, command+up",function(e){e.preventDefault(),bring_forward()}),key("ctrl+shift+up, command+shift+up",function(e){e.preventDefault(),bring_to_front()}),key("ctrl+shift+down, command+shift+down",function(e){e.preventDefault(),send_to_back()}),key("ctrl+down, command+down",function(e){e.preventDefault(),send_backward()}),key("ctrl+l, command+l",function(e){e.preventDefault(),lock()}),key("ctrl+k, command+k",function(e){e.preventDefault(),makeLink()});var pagelist=$(".sitemap ul");multipaged&&(pagelist.empty(),$(".page").each(function(){pagelist.append($("<li>").attr({"data-pageid":$(this).attr("id")}).append($(this).attr("data-pagename")).click(function(){make_page_active($(this).attr("data-pageid"))})),make_page_active($(".page:visible").attr("id"))})),$(".addpage").click(add_new_page),$(".sitemap li").click(function(){make_page_active($(this).attr("data-pageid"))}),$(".pagename-wrap").click(function(){wirepanel.hide(),supercanvas.hasClass("slide-down")?supercanvas.removeClass("slide-down").delay(600).queue(function(e){sharebar.hide(),$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"),exportbtn.removeClass("pressed"),supercanvas.toggleClass("slide-right"),e()}):(supercanvas.removeClass("slide-left , slide-down"),sett.removeClass("pressed"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sharebar.hide(),supercanvas.toggleClass("slide-right"),$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"))}),$("#delete-page").click(function(){$(".sitemap li").length>1?apprise("Are you sure?",{verify:!0},function(e){if(!e)return!1;var a=$(".sitemap .activepage").attr("data-pageid");$(".sitemap .activepage , #"+a).remove();var t=$(".sitemap li").eq(0).attr("data-pageid");make_page_active(t)}):apprise("You can't delete the only page in the project")}),$("#duplicate-page").click(function(){apprise("Enter new name",{verify:!0,input:!0},function(e){if(!e)return!1;$canvas.find(".selected").removeClass("selected");var a=$.now(),t=$(".sitemap .activepage").attr("data-pageid");$("#canvas").append("<div class='page' id='"+a+"' data-pagename='"+e+"'>");var s=$("#"+t).clone();$.each(s.find(".wire"),function(e){var a="w"+$.now()+e;$(this).attr("id",a)}),$("#"+a).append(s.html()),makeDrag($("#"+a+" .wire")),$("#"+a+" .closeannot").click(function(){var e=$(this).parent();e.remove()}),pagelist.append($("<li>").attr({"data-pageid":a}).append(e).click(function(){make_page_active($(this).attr("data-pageid"))})),make_page_active(a,e)})}),function(){$canvas.find(".wire").each(function(){$('[id="'+this.id+'"]').length>1&&$('[id="'+this.id+'"]').not($(this)).each(function(e){this.id+=e})})}(),$("#rename-page").click(function(){apprise("Enter new name",{verify:!0,input:!0},function(e){if(!e)return!1;var a=$(".sitemap .activepage"),t=a.attr("data-pageid");$("#"+t).attr("data-pagename",e),a.text(e),make_page_active(t,e)})}),$("#Link").click(function(){makeLink()}),$("#preview").click(function(){preview()}),$("#re-edit").click(function(){makeEditable(),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sett.removeClass("pressed"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap")}),$(".linkmark").click(function(e){e.stopPropagation(),$("#Link").click()});var gotopage=function(e){e.stopPropagation();var a=$(this).attr("data-link");0!=a&&make_page_active(a)};$(".png").click(function(){$("#canvas .page .wire , #canvas .page .aa").draggable("destroy").resizable("destroy"),$canvaswrap.resizable("destroy");var e=$("#canvas").html(),a=encodeURIComponent(e),t=parseInt($("#canvas-wrap").width(),10)+2,s=parseInt($("#canvas-wrap").height(),10)+2;exporting.show(),$.post("https://wireframe.cc/pro/export_png.php",{data:a,w:t,h:s},function(e){$("iframe").attr("src","https://wireframe.cc/pro/download.php?f="+e),MakeCanvasDrag(),makeDrag($("#canvas .page .wire")),exporting.hide()})}),$(".pdf").click(function(){$("#canvas .page .wire , #canvas .page .aa  ").draggable("destroy").resizable("destroy"),$canvaswrap.resizable("destroy");var e=$("#canvas").html(),a=encodeURIComponent(e),t=parseInt($("#canvas-wrap").width(),10)+2,s=parseInt($("#canvas-wrap").height(),10)+2;exporting.show(),$.post("https://wireframe.cc/pro/export_pdf.php",{data:a,w:t,h:s},function(e){$("iframe").attr("src","https://wireframe.cc/pro/download1.php?f="+e),MakeCanvasDrag(),makeDrag($("#canvas .page .wire")),exporting.hide()})});var sharebar=$(".sharebar"),exportbtn=$(".export");exportbtn.click(function(){exportbtn.toggleClass("pressed"),$(".container").animate({scrollTop:"0px"},{complete:function(){console.log($("body").offset().top),supercanvas.hasClass("slide-left")||supercanvas.hasClass("slide-right")?supercanvas.removeClass("slide-left , slide-right").delay(600).queue(function(e){sharebar.show(),$(this).toggleClass("slide-down"),sett.removeClass("pressed"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),e()}):(sharebar.show(),supercanvas.toggleClass("slide-down"))}})}),previewMode&&$("#canvas .ui-boxer").boxer("destroy"),0==$("#canvas .page:visible").next(".page").length&&$("#next").addClass("inactive"),0==$("#canvas .page:visible").prev(".page").length&&$("#prev").addClass("inactive"),$("#next").click(function(){$("#prev").removeClass("inactive");var e=$(".page:visible"),a=e.next(".page").length;a&&($("#canvas .page:visible").hide().next(".page").show(),$(".pagename").text($("#canvas .page:visible").attr("data-pagename")),$(".activepage").removeClass("activepage"),$("[data-pageid="+$("#canvas .page:visible").attr("id")+"]").addClass("activepage"),0==$("#canvas .page:visible").next(".page").length&&$(this).addClass("inactive"))}),$("#prev").click(function(){$("#next").removeClass("inactive");var e=$(".page:visible"),a=e.prev(".page").length;a&&(e.hide().prev(".page").show(),$(".pagename").text($("#canvas .page:visible").attr("data-pagename")),$(".activepage").removeClass("activepage"),$("[data-pageid="+$("#canvas .page:visible").attr("id")+"]").addClass("activepage"),0==$("#canvas .page:visible").prev(".page").length&&$(this).addClass("inactive"))}),$(".addComment").click(function(){$("#canvas .page:visible").append($("<div class='publiccomment'/>").css({width:"160px",height:"120px",top:"40px",left:"60px","z-index":5e3,position:"absolute"}).append(annotationhtml)),$(".editme").click(divClicked),$("#canvas .thelatest").click(),$("#canvas .closeannot").click(function(){var e=$(this).parent();e.remove(),saveComment()})});var $savecomment=$(".saveComment");supercanvas.click(function(){(supercanvas.hasClass("slide-left")||supercanvas.hasClass("slide-right")||supercanvas.hasClass("slide-down"))&&(supercanvas.removeClass("slide-left , slide-right , slide-down"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),$("#top .settings.pressed").removeClass("pressed"),$("#top .export.pressed").removeClass("pressed"))}),$(document).keyup(function(e){27==e.keyCode&&(wirepanel.hide(),$(".blank").remove())}),jQuery.fn.outerHTML=function(e){return e?this.before(e).remove():jQuery("<p>").append(this.eq(0).clone()).html()},window._link_was_clicked=!1,window.onbeforeunload=function(){return window._link_was_clicked?void 0:$("#canvas .wire").length&&"example"!=filename&&"examplemobile"!=filename?"Are you sure?":void 0},jQuery(document).bind("click","a",function(){window._link_was_clicked=!0}),$.fn.hasAttr=function(e){return void 0!==this.attr(e)},jQuery.fn.htmlClean=function(){return this.contents().filter(function(){return 3!=this.nodeType?($(this).htmlClean(),!1):(this.textContent=$.trim(this.textContent),!/\S/.test(this.nodeValue))}).remove(),this},$canvas.bind("click",".grouped .wirejr",function(e){$(e.target).closest(".grouped").addClass("selected")}),$(".grouped:empty").remove();